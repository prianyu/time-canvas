!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TimeCanvas=e()}(this,function(){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function t(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function e(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=s(i);return a(this,n?(t=s(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function u(t){return t<10?"0".concat(t):t}var h=[[[0,0,1,1,1,0,0],[0,1,1,0,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1,0],[0,0,1,1,1,0,0]],[[0,0,0,1,1,0,0],[0,1,1,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[1,1,1,1,1,1,1]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,1,1,0,0,0],[0,1,1,0,0,0,0],[1,1,0,0,0,0,0],[1,1,0,0,0,1,1],[1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,1,1,0],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,0,0,0,1,1,0],[0,0,0,1,1,1,0],[0,0,1,1,1,1,0],[0,1,1,0,1,1,0],[1,1,0,0,1,1,0],[1,1,1,1,1,1,1],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,1,1]],[[1,1,1,1,1,1,1],[1,1,0,0,0,0,0],[1,1,0,0,0,0,0],[1,1,1,1,1,1,0],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,0,0,0,1,1,0],[0,0,1,1,0,0,0],[0,1,1,0,0,0,0],[1,1,0,0,0,0,0],[1,1,0,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[1,1,1,1,1,1,1],[1,1,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,0,0,1,1,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,1,1,0]],[[0,1,1,1,1,1,0],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,1,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,0,1,1],[0,0,0,0,1,1,0],[0,0,0,1,1,0,0],[0,1,1,0,0,0,0]],[[0,0,0,0],[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],c=["h:i:s","h:i","i:s","s"],l=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"canvas",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};r(this,i),this.options=Object.assign({colors:["#33B5E5","#0099CC","#AA66CC","#9933CC","#99CC00","#669900","#FFBB33","#FF8800","#FF4444","#CC0000"],color:"#0081FF",width:320,height:200,center:!0,middle:!0,padding:20,size:0,ballCount:300,format:c[0]},e),this.id=t||"canvas",this._balls=[],this.context=wx.createCanvasContext(this.id),c.includes(this.options.format)||(this.options.format=c[0])}return t(i,[{key:"_play",value:function(){var t=this;this._clearTimer(),this._timer=setInterval(function(){t._render(),t._update()},50)}},{key:"_pause",value:function(t){var e=this;this._timer&&(this._clearTimer(),!0!==t&&(this._timer=setInterval(function(){e._render(),e._updateBalls()},50)))}},{key:"_destroy",value:function(){var t=this.options,e=t.width,t=t.height;this._clearTimer(),this.context.clearRect(0,0,e,t),this._balls=[]}},{key:"_render",value:function(){var t=this.options,e=t.width,i=t.height,n=this._renderDigit.bind(this),t=this.context,r=this._getRenderData(this._currentTime);this._rect=this._getRect(r);var s=this._rect.top;t.clearRect(0,0,e,i);for(var o=0;o<r.length;o++)n(this._getOffset(r,o),s,r[o]);this._renderBalls(),t.draw()}},{key:"_update",value:function(){var t=this.getCurrentTime(),e=this._getRenderData(t),i=this._getRenderData(this._currentTime),n=this._rect.top;if(this._emit("change",t),e.join("")!=i.join("")){for(var r=0;r<i.length;r++)e[r]!=i[r]&&this._addBall(this._getOffset(i,r),n,i[r]);this._currentTime=t}this._updateBalls(t)}},{key:"_getRenderData",value:function(){}},{key:"_renderBalls",value:function(){for(var t=this._balls,e=this._rect.radius,i=this.context,n=0;n<t.length;n++)i.fillStyle=t[n].color,i.beginPath(),i.arc(t[n].x,t[n].y,e,0,2*Math.PI,!0),i.closePath(),i.fill()}},{key:"_renderDigit",value:function(t,e,i){var n=this.context,r=this._rect.radius,s=r+1;i=":"===i?10:parseInt(i),n.fillStyle=this.options.color;for(var o=0;o<h[i].length;o++)for(var a=0;a<h[i][o].length;a++)1==h[i][o][a]&&(n.beginPath(),n.arc(t+s+2*a*s,e+s+2*o*s,r,0,2*Math.PI),n.closePath(),n.fill())}},{key:"_addBall",value:function(t,e,i){for(var n=this._rect.radius+1,r=this.options.colors,s=0;s<h[i].length;s++)for(var o,a=0;a<h[i][s].length;a++)1==h[i][s][a]&&(o={x:t+2*a*n+n,y:e+2*s*n+n,g:1.5+Math.random(),vx:5*Math.pow(-1,Math.ceil(1e3*Math.random())),vy:-5,color:r[Math.floor(Math.random()*r.length)]},this._balls.push(o))}},{key:"_updateBalls",value:function(){}},{key:"_getRenderBalls",value:function(){for(var t=this.options,e=t.width,i=t.height,n=this._balls,r=this._rect.radius,s=0;s<n.length;s++)n[s].x+=n[s].vx,n[s].y+=n[s].vy,n[s].vy+=n[s].g,n[s].y>=i-r?(n[s].y=i-r,n[s].vy=.75*-n[s].vy):n[s].x>=e-r&&(n[s].x=e-r,n[s].vx=3*-n[s].vx);for(var o=0,a=0;a<n.length;a++)0<n[a].x+r&&n[a].x-r<e&&(n[o++]=n[a]);for(;n.length>Math.min(this.options.ballCount,o);)n.pop();return o}},{key:"_getOffset",value:function(t,e){for(var i=this._rect.left,n=this._rect.radius+1,r=0;r<=e;r++){var s=t[r-1];s&&(i+=(":"===s?9:15)*n)}return i}},{key:"_getRect",value:function(t){for(var e=this.options,i=e.width,n=e.height,r=e.padding,s=e.size,o=e.center,e=e.middle,i=i-2*r,n=n-2*r,a=0,u=0;u<t.length;u++)":"!==t[u]?(a+=14,t[u+1]&&":"!==t[u+1]&&(a+=2)):a+=9;return s=s?s/14-1:i/a-1,s=Math.max(1,s),{left:o?r+i/2-a/2*(s+1):r,top:e?r+n/2-10*(s+1):r,radius:s}}},{key:"_clearTimer",value:function(){clearInterval(this._timer),this._timer=null}},{key:"_emit",value:function(t){t=this.options[t];if("function"==typeof t){for(var e=arguments.length,i=new Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return t.apply(void 0,i)}}}]),i}(),f=["time","count","countdown"],d={type:f[0],autoConvert:!0};return function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&o(t,e)}(n,l);var i=e(n);function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"canvas",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:d;return r(this,n),e=i.call(this,t,e),f.includes(e.options.type)||(e.options.type=f[0]),"time"!==e.options.type&&(0<=Number(e.options.endTime)||(e.options.endTime="count"===e.options.type?1/0:60),e._endTime=1e3*e.options.endTime,e._createState()),e._init(),a(e,e._getInstance())}return t(n,[{key:"_getInstance",value:function(){var e=this,i={};return["pause","play","getCurrentTime","reset","destroy"].map(function(t){i[t]=e[t].bind(e)}),i}},{key:"_init",value:function(){"time"===this.options.type?this._play():(this._currentTime=this.getCurrentTime(),this._render()),this._emit("init",this._currentTime)}},{key:"_createState",value:function(){this._state={ended:!1,stopped:!0,diff:0,waiting:!1}}},{key:"getCurrentTime",value:function(t){var e=t||new Date,i=this.options.type;if("time"===i)return{hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds(),milliseconds:e.getMilliseconds(),now:e};var n=e-((null===(r=this._startTime)||void 0===r?void 0:r.time)||e);"countdown"===i&&(n=Math.max(0,this._endTime-n)),"count"===i&&(n=Math.min(n,this._endTime));var t=parseInt(n/1e3),r=n%1e3;return("countdown"===i&&n<=0||"count"===i&&n>=this._endTime)&&(this._state.ended=!0),{hours:parseInt(t/3600),minutes:parseInt(t%3600/60),seconds:t%60,milliseconds:r,time:e}}},{key:"_resetStartTime",value:function(){var t=new Date,e=this._state.diff,i=new Date(t);this._startTime=null,t.setMilliseconds(t.getMilliseconds()-e),this._startTime=this.getCurrentTime(t),this._currentTime=this.getCurrentTime(i)}},{key:"play",value:function(t){if(!this._state.ended&&this._state.stopped)return this._startTime?0===t?(this._startTime=this._currentTime=this.getCurrentTime(),this._createState()):1===t&&this._resetStartTime():(this._startTime=this._currentTime=this.getCurrentTime(),this._emit("start",this._currentTime)),this._state.stopped=!1,this._play()}},{key:"pause",value:function(t){if(!this._state.stopped)return this._state.stopped=!0,this._state.diff=new Date-this._startTime.time,this._pause(t)}},{key:"reset",value:function(){"time"!==this.type&&(this._clearTimer(),this._balls=[],this._createState(),this._startTime=null,this._currentTime=this.getCurrentTime(),this._render())}},{key:"destroy",value:function(){return this._createState(),this._startTime=null,this._destroy()}},{key:"_getRenderData",value:function(t){var e=t.hours,i=t.minutes,n=t.seconds,r=this.options.type,t=this.options.format;return(t="time"===r||"h:i:s"===t||"h:i"===t||"i:s"===t&&this.options.autoConvert&&e?t.replace("h",u(e)).replace("i",u(i)).replace("s",u(n)):"i:s"===t?"".concat(u(i+60*e),":").concat(u(n)):"".concat(3600*e+60*i+n)).split("")}},{key:"_updateBalls",value:function(t){!this._getRenderBalls()&&this._state.ended&&(this._clearTimer(),this._state.waiting=!1,this._emit("finish",this.currentTime)),this._state.ended&&!this._state.waiting&&(this._emit("end",t),this._state.waiting=!0)}}]),n}()});